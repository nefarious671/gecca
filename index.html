<script>
  async function unlockAccess() {
    const email = document.getElementById("email-input").value.trim().toLowerCase();
    const [usersRes, coursesRes] = await Promise.all([
      fetch("users.json"),
      fetch("courses.json")
    ]);
    const users = await usersRes.json();
    const courses = await coursesRes.json();

    const user = users.find(u => u.email.toLowerCase() === email);

    if (!user) {
      document.getElementById("error").textContent = "Email not recognized. Please contact support.";
      return;
    }

    const list = document.getElementById("materials-list");
    list.innerHTML = "";

    user.courses.forEach(courseName => {
      const courseGroup = courses[courseName];
      if (courseGroup && courseGroup.length > 0) {
        const courseHeader = document.createElement("h3");
        courseHeader.textContent = courseName;
        list.appendChild(courseHeader);

        courseGroup.forEach(item => {
          const li = document.createElement("li");
          const link = document.createElement("a");
          link.href = item.file;
          link.textContent = item.title;
          li.appendChild(link);
          list.appendChild(li);
        });
      }
    });

    document.getElementById("email-gate").style.display = "none";
    document.getElementById("main-content").style.display = "block";
  }
</script>
